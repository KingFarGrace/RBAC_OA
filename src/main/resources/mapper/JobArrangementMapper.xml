<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<!--suppress ALL -->

<mapper namespace="com.kingfar.rbac_backend.mapper.JobArrangementMapper">

    <insert id="setNewGroup">
        INSERT INTO
            groupp(
                gname,
                gcode)
            VALUE(
                #{gname},
                #{gcode})
    </insert>

    <update id="setNewDepartment">
        INSERT INTO
            department(
                dname,
                dcode)
            VALUE(
                #{dname},
                #{dcode})
    </update>

    <update id="setNewRole">
        INSERT INTO
            role(
                rname,
                rcode)
            VALUE(
                #{rname},
                #{rcode})
    </update>

    <resultMap id="groupDetailMap" type="com.kingfar.rbac_backend.pojo.GroupDetailInfo">
        <id property="gid" column="gid"></id>
        <result property="gname" column="gname"></result>
        <result property="gcode" column="gcode"></result>
        <result property="groupMemberCount" column="COUNT(*)"></result>
        <collection property="groupMembers" ofType="String">
            <result column="realname"></result>
        </collection>
    </resultMap>

    <select id="queryGroupDetailInfo" resultMap="groupDetailMap">
        SELECT
            groupp.gid AS gid,
            gname,
            gcode,
            COUNT(*),
            user.realname AS realname
        FROM
            user,
            userGroup,
            groupp
        WHERE
            groupp.gname=#{gname}
            AND groupp.gid=userGroup.gid
            AND userGroup.uid=user.uid
        GROUP BY
            gid
    </select>

</mapper>